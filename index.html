<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>RFPong</title>
    <style>
        :root {
            --bg: #0a0a0a;
            --bg2: #111;
            --bg3: #1a1a1a;
            --accent: #0ea5e9;
            --accent2: #67e8f9;
            --text: #fff;
            --text2: #aaa;
        }
        .light {
            --bg: #f5f5f5;
            --bg2: #e5e5e5;
            --bg3: #d5d5d5;
            --accent: #0284c7;
            --accent2: #0ea5e9;
            --text: #111;
            --text2: #555;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            transition: background 0.3s, color 0.3s;
        }
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
        }
        .logo span { color: var(--accent); }
        .theme-toggle {
            background: var(--bg2);
            border: 1px solid var(--bg3);
            color: var(--text);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
        }
        .theme-toggle:hover {
            background: var(--accent);
            color: #fff;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }
        .score-board {
            display: flex;
            gap: 3rem;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        .score {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }
        .score-label {
            font-size: 0.875rem;
            color: var(--text2);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        .score-value {
            color: var(--accent);
            text-shadow: 0 0 20px var(--accent);
        }
        #gameCanvas {
            border: 2px solid var(--accent);
            border-radius: 0.5rem;
            box-shadow: 0 0 30px rgba(14, 165, 233, 0.3);
            background: var(--bg2);
            touch-action: none;
        }
        .controls {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        .btn {
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            border: none;
            color: #fff;
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(14, 165, 233, 0.4);
        }
        .btn.secondary {
            background: var(--bg3);
            color: var(--text);
        }
        .btn.secondary:hover {
            background: var(--accent);
            color: #fff;
        }
        .difficulty {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        .diff-btn {
            background: var(--bg3);
            border: 2px solid transparent;
            color: var(--text2);
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.3s;
        }
        .diff-btn:hover, .diff-btn.active {
            border-color: var(--accent);
            color: var(--accent);
        }
        .diff-btn.active {
            background: rgba(14, 165, 233, 0.1);
        }
        .message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent);
            text-shadow: 0 0 30px var(--accent);
            text-align: center;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .message.show { opacity: 1; }
        .game-wrapper {
            position: relative;
        }
        .mobile-controls {
            display: none;
            gap: 1rem;
            margin-top: 1rem;
        }
        .mobile-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--bg3);
            border: 2px solid var(--accent);
            color: var(--accent);
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            transition: all 0.2s;
        }
        .mobile-btn:active {
            background: var(--accent);
            color: #fff;
            transform: scale(0.95);
        }
        @media (max-width: 768px) {
            .score-board { font-size: 1.75rem; gap: 2rem; }
            .mobile-controls { display: flex; }
            .controls { flex-wrap: wrap; justify-content: center; }
        }
        @media (max-width: 500px) {
            .header { padding: 0.75rem 1rem; }
            .logo { font-size: 1.25rem; }
            .score-board { font-size: 1.5rem; gap: 1.5rem; }
        }
        .instructions {
            color: var(--text2);
            font-size: 0.875rem;
            text-align: center;
            margin-top: 0.5rem;
        }
        .win-line {
            font-size: 0.875rem;
            color: var(--text2);
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo"><span>RF</span>Pong</div>
        <button class="theme-toggle" onclick="toggleTheme()">ðŸŒ™</button>
    </header>

    <div class="container">
        <div class="score-board">
            <div class="score">
                <span class="score-label">You</span>
                <span class="score-value" id="playerScore">0</span>
            </div>
            <div class="score">
                <span class="score-label">AI</span>
                <span class="score-value" id="aiScore">0</span>
            </div>
        </div>
        <span class="win-line">First to <span id="winTarget">5</span> wins!</span>
        
        <div class="game-wrapper">
            <canvas id="gameCanvas"></canvas>
            <div class="message" id="message"></div>
        </div>

        <div class="mobile-controls">
            <button class="mobile-btn" id="upBtn">â–²</button>
            <button class="mobile-btn" id="downBtn">â–¼</button>
        </div>

        <div class="controls">
            <button class="btn" id="startBtn" onclick="startGame()">Start</button>
            <button class="btn secondary" onclick="resetGame()">Reset</button>
        </div>

        <div class="difficulty">
            <button class="diff-btn active" data-diff="easy">Easy</button>
            <button class="diff-btn" data-diff="medium">Medium</button>
            <button class="diff-btn" data-diff="hard">Hard</button>
            <button class="diff-btn" data-diff="impossible">ðŸ’€</button>
        </div>

        <p class="instructions">Use â†‘â†“ or W/S to move â€¢ Touch buttons on mobile</p>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const messageEl = document.getElementById('message');
        const playerScoreEl = document.getElementById('playerScore');
        const aiScoreEl = document.getElementById('aiScore');
        const startBtn = document.getElementById('startBtn');

        // Responsive canvas
        function resizeCanvas() {
            const maxW = Math.min(window.innerWidth - 40, 800);
            const maxH = Math.min(window.innerHeight - 350, 500);
            const ratio = 800 / 500;
            
            if (maxW / ratio <= maxH) {
                canvas.width = maxW;
                canvas.height = maxW / ratio;
            } else {
                canvas.height = maxH;
                canvas.width = maxH * ratio;
            }
            
            // Scale game objects
            scale = canvas.width / 800;
        }
        
        let scale = 1;
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Audio
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(freq, duration, type = 'square') {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.value = freq;
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialDecayTo && gain.gain.exponentialDecayTo(0.01, audioCtx.currentTime + duration);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        // Game state
        let gameRunning = false;
        let playerScore = 0;
        let aiScore = 0;
        const winScore = 5;
        
        // Difficulty settings
        const difficulties = {
            easy: { aiSpeed: 3, aiReaction: 0.02, aiError: 40 },
            medium: { aiSpeed: 5, aiReaction: 0.04, aiError: 20 },
            hard: { aiSpeed: 7, aiReaction: 0.08, aiError: 10 },
            impossible: { aiSpeed: 10, aiReaction: 0.15, aiError: 0 }
        };
        let currentDiff = 'easy';

        // Paddles & Ball (base values for 800x500)
        const paddleW = 12;
        const paddleH = 80;
        const ballSize = 12;
        
        let player = { x: 20, y: 250 - paddleH/2, w: paddleW, h: paddleH, speed: 8, dy: 0 };
        let ai = { x: 800 - 20 - paddleW, y: 250 - paddleH/2, w: paddleW, h: paddleH, speed: 5, targetY: 250 };
        let ball = { x: 400, y: 250, r: ballSize/2, dx: 5, dy: 3, speed: 5, trail: [] };

        // Particles
        let particles = [];

        function spawnParticles(x, y, color, count = 10) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: x * scale,
                    y: y * scale,
                    dx: (Math.random() - 0.5) * 8,
                    dy: (Math.random() - 0.5) * 8,
                    life: 1,
                    color: color,
                    size: Math.random() * 4 + 2
                });
            }
        }

        // Screen shake
        let shakeAmount = 0;

        // Input
        let keys = {};
        document.addEventListener('keydown', e => {
            keys[e.key.toLowerCase()] = true;
            if (['arrowup', 'arrowdown', 'w', 's', ' '].includes(e.key.toLowerCase())) {
                e.preventDefault();
            }
            // Resume audio context on key press
            if (audioCtx.state === 'suspended') audioCtx.resume();
        });
        document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

        // Mobile controls
        const upBtn = document.getElementById('upBtn');
        const downBtn = document.getElementById('downBtn');
        let mobileUp = false, mobileDown = false;

        upBtn.addEventListener('touchstart', e => { e.preventDefault(); mobileUp = true; if (audioCtx.state === 'suspended') audioCtx.resume(); });
        upBtn.addEventListener('touchend', e => { e.preventDefault(); mobileUp = false; });
        downBtn.addEventListener('touchstart', e => { e.preventDefault(); mobileDown = true; if (audioCtx.state === 'suspended') audioCtx.resume(); });
        downBtn.addEventListener('touchend', e => { e.preventDefault(); mobileDown = false; });

        // Touch on canvas
        canvas.addEventListener('touchstart', e => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
        });
        canvas.addEventListener('touchmove', e => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const y = e.touches[0].clientY - rect.top;
            player.y = Math.max(0, Math.min(canvas.height - player.h * scale, y - (player.h * scale) / 2)) / scale;
        }, { passive: false });

        // Difficulty buttons
        document.querySelectorAll('.diff-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentDiff = btn.dataset.diff;
                if (!gameRunning) resetBall();
            });
        });

        // Theme
        function toggleTheme() {
            document.body.classList.toggle('light');
            const btn = document.querySelector('.theme-toggle');
            btn.textContent = document.body.classList.contains('light') ? 'â˜€ï¸' : 'ðŸŒ™';
        }

        function resetBall(scorer = null) {
            ball.x = 400;
            ball.y = 250;
            ball.speed = 5;
            ball.trail = [];
            // Ball goes toward whoever got scored on
            const dir = scorer === 'player' ? 1 : (scorer === 'ai' ? -1 : (Math.random() > 0.5 ? 1 : -1));
            const angle = (Math.random() - 0.5) * Math.PI / 3;
            ball.dx = dir * Math.cos(angle) * ball.speed;
            ball.dy = Math.sin(angle) * ball.speed;
        }

        function showMessage(text, duration = 1500) {
            messageEl.textContent = text;
            messageEl.classList.add('show');
            setTimeout(() => messageEl.classList.remove('show'), duration);
        }

        function startGame() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            if (playerScore >= winScore || aiScore >= winScore) {
                resetGame();
            }
            
            if (!gameRunning) {
                gameRunning = true;
                startBtn.textContent = 'Pause';
                showMessage('GO!', 800);
                playSound(440, 0.1);
                setTimeout(() => playSound(880, 0.15), 100);
            } else {
                gameRunning = false;
                startBtn.textContent = 'Resume';
                showMessage('PAUSED');
            }
        }

        function resetGame() {
            gameRunning = false;
            playerScore = 0;
            aiScore = 0;
            playerScoreEl.textContent = '0';
            aiScoreEl.textContent = '0';
            player.y = 250 - paddleH/2;
            ai.y = 250 - paddleH/2;
            resetBall();
            particles = [];
            startBtn.textContent = 'Start';
            messageEl.classList.remove('show');
        }

        function update() {
            if (!gameRunning) return;

            const diff = difficulties[currentDiff];

            // Player movement
            player.dy = 0;
            if (keys['arrowup'] || keys['w'] || mobileUp) player.dy = -player.speed;
            if (keys['arrowdown'] || keys['s'] || mobileDown) player.dy = player.speed;
            
            player.y += player.dy;
            player.y = Math.max(0, Math.min(500 - player.h, player.y));

            // AI movement
            const aiCenter = ai.y + ai.h / 2;
            const targetY = ball.y + (Math.random() - 0.5) * diff.aiError;
            ai.targetY += (targetY - ai.targetY) * diff.aiReaction;
            
            if (aiCenter < ai.targetY - 5) {
                ai.y += Math.min(diff.aiSpeed, ai.targetY - aiCenter);
            } else if (aiCenter > ai.targetY + 5) {
                ai.y -= Math.min(diff.aiSpeed, aiCenter - ai.targetY);
            }
            ai.y = Math.max(0, Math.min(500 - ai.h, ai.y));

            // Ball movement
            ball.trail.unshift({ x: ball.x, y: ball.y });
            if (ball.trail.length > 15) ball.trail.pop();

            ball.x += ball.dx;
            ball.y += ball.dy;

            // Wall collision
            if (ball.y - ball.r <= 0 || ball.y + ball.r >= 500) {
                ball.dy *= -1;
                ball.y = ball.y - ball.r <= 0 ? ball.r : 500 - ball.r;
                playSound(300, 0.05);
                spawnParticles(ball.x, ball.y, '#67e8f9', 5);
            }

            // Paddle collision
            // Player paddle
            if (ball.dx < 0 && 
                ball.x - ball.r <= player.x + player.w &&
                ball.x + ball.r >= player.x &&
                ball.y >= player.y && 
                ball.y <= player.y + player.h) {
                
                const hitPos = (ball.y - player.y) / player.h - 0.5;
                ball.dx = Math.abs(ball.dx);
                ball.dy = hitPos * 8;
                ball.speed = Math.min(ball.speed + 0.3, 12);
                
                const speed = Math.sqrt(ball.dx * ball.dx + ball.dy * ball.dy);
                ball.dx = (ball.dx / speed) * ball.speed;
                ball.dy = (ball.dy / speed) * ball.speed;
                
                ball.x = player.x + player.w + ball.r;
                
                playSound(440, 0.08);
                spawnParticles(ball.x, ball.y, '#0ea5e9', 15);
                shakeAmount = 5;
            }

            // AI paddle
            if (ball.dx > 0 && 
                ball.x + ball.r >= ai.x &&
                ball.x - ball.r <= ai.x + ai.w &&
                ball.y >= ai.y && 
                ball.y <= ai.y + ai.h) {
                
                const hitPos = (ball.y - ai.y) / ai.h - 0.5;
                ball.dx = -Math.abs(ball.dx);
                ball.dy = hitPos * 8;
                ball.speed = Math.min(ball.speed + 0.3, 12);
                
                const speed = Math.sqrt(ball.dx * ball.dx + ball.dy * ball.dy);
                ball.dx = (ball.dx / speed) * ball.speed;
                ball.dy = (ball.dy / speed) * ball.speed;
                
                ball.x = ai.x - ball.r;
                
                playSound(330, 0.08);
                spawnParticles(ball.x, ball.y, '#0ea5e9', 15);
                shakeAmount = 5;
            }

            // Scoring
            if (ball.x < -ball.r) {
                aiScore++;
                aiScoreEl.textContent = aiScore;
                playSound(220, 0.3, 'sawtooth');
                spawnParticles(0, ball.y, '#ef4444', 30);
                shakeAmount = 15;
                
                if (aiScore >= winScore) {
                    gameRunning = false;
                    showMessage('AI WINS!', 3000);
                    startBtn.textContent = 'Play Again';
                } else {
                    resetBall('ai');
                }
            }

            if (ball.x > 800 + ball.r) {
                playerScore++;
                playerScoreEl.textContent = playerScore;
                playSound(660, 0.15);
                setTimeout(() => playSound(880, 0.15), 100);
                spawnParticles(800, ball.y, '#22c55e', 30);
                shakeAmount = 10;
                
                if (playerScore >= winScore) {
                    gameRunning = false;
                    showMessage('YOU WIN! ðŸŽ‰', 3000);
                    startBtn.textContent = 'Play Again';
                } else {
                    resetBall('player');
                }
            }

            // Update particles
            particles = particles.filter(p => {
                p.x += p.dx;
                p.y += p.dy;
                p.life -= 0.02;
                p.dy += 0.1; // gravity
                return p.life > 0;
            });

            // Decay shake
            shakeAmount *= 0.9;
        }

        function draw() {
            ctx.save();
            
            // Apply screen shake
            if (shakeAmount > 0.5) {
                ctx.translate(
                    (Math.random() - 0.5) * shakeAmount * scale,
                    (Math.random() - 0.5) * shakeAmount * scale
                );
            }

            // Clear
            const isDark = !document.body.classList.contains('light');
            ctx.fillStyle = isDark ? '#111' : '#e5e5e5';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Center line
            ctx.setLineDash([10 * scale, 10 * scale]);
            ctx.strokeStyle = isDark ? '#333' : '#ccc';
            ctx.lineWidth = 2 * scale;
            ctx.beginPath();
            ctx.moveTo(canvas.width / 2, 0);
            ctx.lineTo(canvas.width / 2, canvas.height);
            ctx.stroke();
            ctx.setLineDash([]);

            // Ball trail
            ball.trail.forEach((pos, i) => {
                const alpha = (1 - i / ball.trail.length) * 0.5;
                const size = ball.r * (1 - i / ball.trail.length) * scale;
                ctx.beginPath();
                ctx.arc(pos.x * scale, pos.y * scale, size, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(14, 165, 233, ${alpha})`;
                ctx.fill();
            });

            // Ball
            ctx.beginPath();
            ctx.arc(ball.x * scale, ball.y * scale, ball.r * scale, 0, Math.PI * 2);
            ctx.fillStyle = '#0ea5e9';
            ctx.shadowColor = '#0ea5e9';
            ctx.shadowBlur = 20 * scale;
            ctx.fill();
            ctx.shadowBlur = 0;

            // Ball inner glow
            ctx.beginPath();
            ctx.arc(ball.x * scale, ball.y * scale, ball.r * 0.5 * scale, 0, Math.PI * 2);
            ctx.fillStyle = '#67e8f9';
            ctx.fill();

            // Paddles
            ctx.shadowColor = '#0ea5e9';
            ctx.shadowBlur = 15 * scale;
            
            // Player paddle
            ctx.fillStyle = '#0ea5e9';
            ctx.beginPath();
            ctx.roundRect(player.x * scale, player.y * scale, player.w * scale, player.h * scale, 4 * scale);
            ctx.fill();

            // AI paddle
            ctx.fillStyle = '#67e8f9';
            ctx.beginPath();
            ctx.roundRect(ai.x * scale, ai.y * scale, ai.w * scale, ai.h * scale, 4 * scale);
            ctx.fill();

            ctx.shadowBlur = 0;

            // Particles
            particles.forEach(p => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size * p.life * scale, 0, Math.PI * 2);
                ctx.fillStyle = p.color + Math.floor(p.life * 255).toString(16).padStart(2, '0');
                ctx.fill();
            });

            ctx.restore();
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // Start
        resetBall();
        gameLoop();

        // Space to start/pause
        document.addEventListener('keydown', e => {
            if (e.key === ' ') {
                e.preventDefault();
                startGame();
            }
        });
    </script>
</body>
</html>
